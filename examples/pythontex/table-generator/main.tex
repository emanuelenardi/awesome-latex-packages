\PassOptionsToPackage{
	autoprint = true
}{pythontex}

\documentclass[a4paper]{article}

\usepackage{
	booktabs,
	colortbl,
	xcolor
}

\usepackage{comment}
\usepackage{pythontex}

% arara: pdflatex
% arara: pythontex
% arara: indent: {overwrite: true, silent: on}
% arara: pdflatex
\begin{document}

\section{Truth table}

\begin{sympycode}
def printTableOfTruth(expressions):
	print(r'\begin{table}[htbp]')
	print(r'\centering')
	if not caption:
		print(r'\caption{Truth table dynamically generated by \texttt{pythontex}}')
	elif not label:
		print(r'\caption{' + caption + '}')
		caption == ""
	else:
		print(r'\caption{' + caption + '}%')
		print('\label{tab:' + label + '}')
		caption == ""
		label == ""
	print(r'\begin{tabular}{@{}' + ' c '*(len(variables) + len(expressions)) + '@{}}')
	# print table header:
	print(r'\toprule')
	print(' & '.join('\(' + latex(i) + '\)' for i in variables + expressions) + r' \tabularnewline')
	print(r'\midrule')
	# generate and print rows of truth table:
	combinations = cartes([True, False], repeat = len(variables))
	no_combinations = 2**len(variables)
	# for each combination of true and false
	for index, var_values in enumerate(combinations):
		# assegno le combinazioni alle variabili
		value_dict = dict(zip(list(variables), var_values))
		# evaluation of true value
		lista = list(var_values) + [i.subs(value_dict) for i in expressions]
		# True -> 'T', False -> 'F'
		changed = ['T' if x == True else 'F' for x in lista]
		# pretty printing of the values
		print(' & '.join(str(i) for i in changed))
		if index == 0:
			# from now on all the midrule are going to be lightgray
			print(r'\tabularnewline\arrayrulecolor{gray!20}\midrule')
		elif index != (no_combinations - 1):
			print(r'\tabularnewline\midrule')
		else:
			# print table footer
			print(r'\tabularnewline\arrayrulecolor{black}\bottomrule')
	# closing of the tags
	print(r'\end{tabular}')
	print(r'\end{table}')
\end{sympycode}

\begin{sympycode}
# declare symbols used
a, b, c = symbols("a b c")

# variables to print
variables = (a, b, c)

# define expressions:
exprs = (a & b, a | b, a >> b)

caption = "Didascalia"

label = "etichetta"

printTableOfTruth(exprs)
\end{sympycode}

\begin{sympycode}
def printTableOfTruth(expressions):
	print(r'\begin{table}[h]')
	print(r'\centering')
	# dinamically generated caption
	print(r'\caption{Table of truth dinamically generated by \texttt{pythontex}}')
	# print(r'\caption{' + ', '.join('\(' + latex(i) + '\)' for i in expressions) + '}')
	print(r'\begin{tabular}{@{}' + ' c '*len(variables) + '|' + ' c '*len(expressions) + '@{}}')
	# print table header:
	# print(r'\toprule')
	# print(' & '.join('\(' + latex(i) + '\)' for i in variables + expressions) + r' \tabularnewline')
	print(' & '.join('\(' + latex(i) + '\)' for i in variables + expressions) + r' \tabularnewline')
	print(r'\hline')
	# generate and print rows of truth table:
	# for each combination of true and false
	for var_values in cartes([True, False], repeat = len(variables)):
		value_dict = dict(zip(list(variables), var_values))
		lista = list(var_values) + [i.subs(value_dict) for i in expressions]
		# crea i valori nella tabella
		# changed = map(lambda x:'T' if x == True else 'F', lista)
		changed = ['T' if x == True else 'F' for x in lista]
		print(' & '.join(str(i) for i in changed) + r' \tabularnewline')
	# print table footer
	# print(r'\bottomrule')
	print(r'\end{tabular}')
	print(r'\end{table}')
\end{sympycode}

\begin{sympycode}
# define expressions:
exprs = (a & b, a | b, a >> b)

printTableOfTruth(exprs)
\end{sympycode}

\end{document}
